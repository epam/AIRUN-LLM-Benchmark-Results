import {CreateSlice, Payload} from '@reduxjs/toolkit';
import { nanid } from 'nanid';
import { Todo } from '../types/todo';

const initialState: Todo[] = JSON.parse(localStorage.getItem('todos-angularjs-requirejs') || '[]');

const todosSlice = createSlice({
  name: 'todos',
  initialState,
  reducers: {
    addTodo: (state, action: Payload<{ title: string }> => {
      const newTodo = { id: nanid(), title: action.payload.title, completed: false };
      const updatedTodos = [newTodo, ...state];
      localStorage.setItem('todos-angularjs-requirejs', JSON.stringify(updatedTodos));
      return updatedTodos;
    },
    removeTodo: (state, action: Payload<any>) => {
      const updatedTodos = state.filter(todo => todo.id !== action.payload);
      localStorage.setItem('todos-angularjs-requirejs', JSON.stringify(updatedTodos));
      return updatedTodos;
    },
    markAll: (state, action: Payload<any>) => {
      const updatedTodos = state.map(todo => ({ ...todo, completed: action.payload }));
      localStorage.setItem('todos-angularjs-requirejs', JSON.stringify(updatedTodos));
      return updatedTodos;
    },
    editTitle: (state, action: Payload<{ id: string, title: string }>) => {
      const updatedTodos = state.map(todo => (todo.id === action.payload.id ? ...todo, title: action.payload.title }));
      localStorage.setItem('todos-angularjs-requirejs', JSON.stringify(updatedTodos));
      return updatedTodos;
    },
    clearCompleted: (state)=> {
      const updatedTodos = state.filter(todo => !todo.completed);
      localStorage.setItem('todos-angularjs-requirejs', JSON.stringify(updatedTodos));
      return updatedTodos;
    }
});

export const {AddTodo, RemoveTodo, MarkAll, EditTitle, ClearCompleted} = todosSlice.slice;
